<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <link rel="stylesheet" href="https://lkummer.github.io/Helm-Charts/main.css">
    <title>backup</title>
    <link rel="icon" href="https://lkummer.github.io/Helm-Charts/images/favicon.svg">
    <meta name="description" content="Restic based backup and restore solution for persistent volume claims.">
    <meta name="twitter:card" content="summary_large_image" />
    <meta property="og:url" content="https://lkummer.github.io/Helm-Charts/backup/" />
    <meta property="og:title" content="backup" />
    <meta property="og:description" content="Restic based backup and restore solution for persistent volume claims." />
    <meta property="og:image" content="https://lkummer.github.io/Helm-Charts/images/cover-16x9.png" />
    <meta property="og:image:height" content="1080" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:type" content="article" />
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "backup",
      "image": ["https://lkummer.github.io/Helm-Charts/images/cover-1x1.png","https://lkummer.github.io/Helm-Charts/images/cover-4x3.png","https://lkummer.github.io/Helm-Charts/images/cover-16x9.png"]
    }
    </script>
  </head>
  <body class="l-footer-page">
<header class="l-masthead">
  <section class="l-masthead-top l-masthead-top-dense">
    <div class="l-container">
      <nav>
        <ul class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="https://lkummer.github.io/Helm-Charts" class="breadcrumb-item-link">
              Lior&#39;s Charts
            </a>
          </li>
          <li class="breadcrumb-item">
            backup
          </li>
        </ul>
      </nav>
      <h1 class="introduction-title">
        BACKUP
      </h1>
    </div>
  </section>
  <section class="l-masthead-bottom l-container">
    <p class="introduction-description">
      Restic based backup and restore solution for persistent volume claims.
    </p>
  </section>
</header>
<section class="l-container content l-footer-grow">
  <h2 id="prerequisites">Prerequisites</h2>
<p>Add the repository to Helm:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">helm</span> <span class="n">repo</span> <span class="n">add</span> <span class="n">homelab</span> <span class="n">https</span><span class="o">://</span><span class="n">lkummer.github.io</span><span class="o">/</span><span class="n">Helm</span><span class="o">-</span><span class="n">Charts</span>
<span class="o">$</span> <span class="n">helm</span> <span class="n">repo</span> <span class="n">update</span>
</code></pre></div><p>Restic REST server or another form of storage for Restic repositories is
required.
Support for cloud providers will be added soon.</p>
<h2 id="deploy-the-chart">Deploy the Chart</h2>
<p>Create a <code>values.yaml</code> file with values you wish to override.</p>
<p>Install the chart:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">helm</span> <span class="n">install</span> <span class="n">example</span> <span class="n">homelab</span><span class="o">/</span><span class="n">backup</span> <span class="o">--</span><span class="n">file</span> <span class="n">values.yaml</span>
</code></pre></div><h2 id="upgrade-the-chart">Upgrade the Chart</h2>
<p>Upgrade the chart:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">helm</span> <span class="n">upgrade</span> <span class="n">example</span> <span class="n">homelab</span><span class="o">/</span><span class="n">backup</span> <span class="o">--</span><span class="n">file</span> <span class="n">values.yaml</span>
</code></pre></div><h2 id="delete-the-chart">Delete the Chart</h2>
<p>Delete the chart:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-s" data-lang="s"><span class="o">$</span> <span class="n">helm</span> <span class="n">delete</span> <span class="n">example</span>
</code></pre></div><h2 id="configuration">Configuration</h2>
<p>The chart offers the following list of configuration values.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nameOverride</code></td>
<td>Override the name of the chart.</td>
</tr>
<tr>
<td><code>fullnameOverride</code></td>
<td>Override the full name of the chart.</td>
</tr>
<tr>
<td><code>image</code></td>
<td>Restic image settings.</td>
</tr>
<tr>
<td><code>image.repository</code></td>
<td>Image repository and name to use.</td>
</tr>
<tr>
<td><code>image.tag</code></td>
<td>Image version tag to use.</td>
</tr>
<tr>
<td><code>image.pullPolicy</code></td>
<td>Image pull policy.</td>
</tr>
<tr>
<td><code>repositories</code></td>
<td>List of Restic repositories to use.</td>
</tr>
<tr>
<td><code>repositories.name</code></td>
<td>Name of the Restic repository.</td>
</tr>
<tr>
<td><code>repositories.address</code></td>
<td>Address of the Restic repository.</td>
</tr>
<tr>
<td><code>repositories.password</code></td>
<td>Password for the Restic repository.</td>
</tr>
<tr>
<td><code>repositories.create</code></td>
<td>Options for creating the repository.</td>
</tr>
<tr>
<td><code>repositories.create.enabled</code></td>
<td>Enable repository creation.</td>
</tr>
<tr>
<td><code>repositories.create.restartPolicy</code></td>
<td>Restart policy for repository creation job.</td>
</tr>
<tr>
<td><code>repositories.restore</code></td>
<td>Options for restoring from the repository.</td>
</tr>
<tr>
<td><code>repositories.restore.enabled</code></td>
<td>Enable restore job from the repository.</td>
</tr>
<tr>
<td><code>repositories.restore.snapshot</code></td>
<td>Name of the snapshot to restore from.</td>
</tr>
<tr>
<td><code>repositories.restore.restartPolicy</code></td>
<td>Restart policy for restore job.</td>
</tr>
<tr>
<td><code>repositories.backup</code></td>
<td>Options for backup cron job.</td>
</tr>
<tr>
<td><code>repositories.backup.enabled</code></td>
<td>Enable backup cron job.</td>
</tr>
<tr>
<td><code>repositories.backup.schedule</code></td>
<td>Cron schedule to run backup jobs.</td>
</tr>
<tr>
<td><code>repositories.backup.restartPolicy</code></td>
<td>Restart policy for backup jobs.</td>
</tr>
<tr>
<td><code>repositories.forget</code></td>
<td>Options for snapshot removal cron job.</td>
</tr>
<tr>
<td><code>repositories.forget.enabled</code></td>
<td>Enable forget cron job.</td>
</tr>
<tr>
<td><code>repositories.forget.schedule</code></td>
<td>Cron schedule to run forget jobs.</td>
</tr>
<tr>
<td><code>repositories.forget.keep</code></td>
<td>Options for keeping snapshots.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.last</code></td>
<td>Keep last amount of snapshots.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.hourly</code></td>
<td>Keep hourly snapshots for amount of hours.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.daily</code></td>
<td>Keep daily snapshots for amount of days.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.weekly</code></td>
<td>Keep weekly snapshots for amount of weeks.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.monthly</code></td>
<td>Keep monthly snapshots for amount of months.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.yearly</code></td>
<td>Keep yearly snapshots for amount of years.</td>
</tr>
<tr>
<td><code>repositories.forget.keep.within</code></td>
<td>Keep snapshots within duration.</td>
</tr>
<tr>
<td><code>repositories.forget.restartPolicy</code></td>
<td>Restart policy for forget jobs.</td>
</tr>
<tr>
<td><code>volumeClaims</code></td>
<td>Persistent volume claims to create and manage.</td>
</tr>
<tr>
<td><code>volumeClaims.enabled</code></td>
<td>Enable persistent volume claims creation.</td>
</tr>
<tr>
<td><code>volumeClaims.claims</code></td>
<td>List of persistent volume claims to manage.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.name</code></td>
<td>Name of the persistent volume claim.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.repositoryPath</code></td>
<td>Path to use for backups in Restic repositories.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.annotations</code></td>
<td>Kubernetes annotations for the persistent volume claim.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.resources</code></td>
<td>Resource requests of the persistent volume claim.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.volumeMode</code></td>
<td>Volume mode of the persistent volume claim.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.accessModes</code></td>
<td>Access modes of the persistent volume claim.</td>
</tr>
<tr>
<td><code>volumeClaims.claims.selector</code></td>
<td>Selector of the persistent volume claim.</td>
</tr>
</tbody>
</table>
<h2 id="examples">Examples</h2>
<p>Basic usage examples to get you up and running quickly.</p>
<h3 id="starting-from-scratch">Starting from Scratch</h3>
<p>Create <code>some-volume</code> persistent volume claim, create Restic repository and basic backup
and forget jobs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">repositories</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rest</span><span class="w">
</span><span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l">rest:http://user:pass@address:8000/repo</span><span class="w">
</span><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">secret</span><span class="w">
</span><span class="w">    </span><span class="nt">create</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">backup</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">forget</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="nt">keep</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">daily</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span><span class="w">  
</span><span class="w"></span><span class="nt">volumeClaims</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span><span class="nt">claims</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">some-volume</span><span class="w">
</span><span class="w">      </span><span class="nt">repositoryPath</span><span class="p">:</span><span class="w"> </span><span class="l">some-volume</span><span class="w">
</span><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">10Gi</span><span class="w">
</span></code></pre></div><h3 id="disaster-recovery">Disaster Recovery</h3>
<p>Restore latest <code>some-volume</code> snapshot from existing Restic repository.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">repositories</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rest</span><span class="w">
</span><span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l">rest:http://user:pass@address:8000/repo</span><span class="w">
</span><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">secret</span><span class="w">
</span><span class="w">    </span><span class="nt">restore</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">backup</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">8</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w">
</span><span class="w">    </span><span class="nt">forget</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">8</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w">
</span><span class="w">      </span><span class="nt">keep</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">daily</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span><span class="w">  
</span><span class="w"></span><span class="nt">volumeClaims</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span><span class="nt">claims</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">some-volume</span><span class="w">
</span><span class="w">      </span><span class="nt">repositoryPath</span><span class="p">:</span><span class="w"> </span><span class="l">some-volume</span><span class="w">
</span><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">10Gi</span><span class="w">
</span></code></pre></div><h2 id="quirks">Quirks</h2>
<p>During restoration, the entire repository is downloaded.
It is recommended to create separate repositories for separate namespaces to avoid
wasting traffic when restoring in multiple namespaces.</p>

</section>

    <footer class="l-footer">
      <section class="l-container">
        Star
        <a href="https://github.com/LKummer/Helm-Charts" class="footer-link">the source on Github</a>.
        <br>
        Made with
        <svg class="footer-heart" viewBox="0 0 16 16" aria-label="Heart icon">
          <path class="footer-heart-fill" d="M8,14.9c-0.1,0-0.3-0.1-0.4-0.2L1.7,7.6C1.1,6.9,0.8,6,0.8,5.1c0-2.2,1.8-4,4-4c1.2,0,2.3,0.5,3,1.4
            c0,0,0,0.1,0.1,0.1L8,2.9l0.2-0.3c0.8-1,1.9-1.5,3.1-1.5c2.2,0,4,1.8,4,4c0,0.9-0.3,1.8-0.9,2.5l-5.9,7.1C8.3,14.8,8.1,14.9,8,14.9
            z"/>
          <path class="footer-heart-stroke" d="M11.3,1.6c1.9,0,3.5,1.5,3.5,3.5c0,0.9-0.3,1.6-0.8,2.2l0,0L12.5,9L8,14.4L3.5,9L2.1,7.3C1.6,6.7,1.3,5.9,1.3,5.1
            c0-1.9,1.5-3.5,3.5-3.5c1.1,0,2,0.5,2.6,1.2l0,0L8,3.6l0.6-0.7l0-0.1C9.3,2.1,10.2,1.6,11.3,1.6 M11.3,0.6C10,0.6,8.8,1.2,8,2.1
            C7.2,1.2,6,0.6,4.7,0.6c-2.5,0-4.5,2-4.5,4.5c0,1,0.4,2.1,1,2.9l1.4,1.7L7.2,15c0.2,0.2,0.5,0.4,0.8,0.4c0.3,0,0.6-0.1,0.8-0.4
            l4.5-5.4L14.7,8c0,0,0-0.1,0.1-0.1c0.7-0.8,1-1.8,1-2.8C15.8,2.6,13.8,0.6,11.3,0.6L11.3,0.6z"/>
        </svg>
        by
        <a href="https://github.com/LKummer/" class="footer-link">Lior Kummer</a>.
      </section>
    </footer>
    <script src='https://lkummer.github.io/Helm-Charts/main.js'></script>
  </body>
</html>
